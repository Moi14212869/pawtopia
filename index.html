<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mini Pet World</title>

<style>
body{
  font-family: Arial;
  background:#f0f4f8;
  text-align:center;
  margin:0;
}

nav{
  background:#4CAF50;
  padding:10px;
}

nav button{
  margin:5px;
  padding:8px 15px;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

.page{ display:none; padding:20px; }
.active{ display:block; }

.card{
  background:white;
  padding:20px;
  border-radius:10px;
  width:320px;
  margin:auto;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
}

.progress{
  background:#ddd;
  border-radius:10px;
  overflow:hidden;
  height:20px;
  margin:5px 0;
}

.progress div{
  height:100%;
  background:#4CAF50;
  width:50%;
}

#board{
  display:grid;
  grid-template-columns:repeat(5,50px);
  gap:5px;
  justify-content:center;
  margin:15px 0;
}

.cell{
  width:50px;
  height:50px;
  background:#ccc;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-weight:bold;
  font-size:18px;
}

.cell.revealed{
  background:#eee;
  cursor:default;
}
</style>
</head>
<body>

<nav>
  <button onclick="showPage('pet')">ğŸ¾ Animal</button>
  <button onclick="showPage('shop')">ğŸ›’ Boutique</button>
  <button onclick="showPage('games')">ğŸ® Jeux</button>
  <button onclick="showPage('adoption')">â• Adoption</button>
</nav>

<!-- ACCUEIL -->
<div id="home" class="page">
  <div class="card">
    <h1>ğŸŒ Mini Pet World</h1>
    <p>Bienvenue dans ton monde virtuel !</p>
    <button onclick="showPage('adoption')">ğŸ¾ Adopter un animal</button>
  </div>
</div>

<!-- PAGE ANIMAL -->
<div id="pet" class="page">
  <div class="card">
    <h2 id="petName"></h2>
    <p>ğŸ’° PiÃ¨ces : <span id="coinsDisplay"></span></p>

    <p>ğŸ˜Š Bonheur</p>
    <div class="progress"><div id="happinessBar"></div></div>

    <p>ğŸ— Faim</p>
    <div class="progress"><div id="hungerBar"></div></div>

    <p>ğŸ˜¢ Tristesse</p>
    <div class="progress"><div id="sadnessBar"></div></div>

    <button onclick="feed()">ğŸ Nourrir (-5 piÃ¨ces)</button>
    <button onclick="play()">ğŸ¾ Jouer</button>
  </div>
</div>

<!-- ADOPTION -->
<div id="adoption" class="page">
  <div class="card">
    <h2>Adoption</h2>
    <input id="newPetName" placeholder="Nom de l'animal">
    <button onclick="adopt()">Adopter</button>
  </div>
</div>

<!-- BOUTIQUE -->
<div id="shop" class="page">
  <div class="card">
    <h2>Boutique</h2>
    <p>ğŸ’° PiÃ¨ces : <span id="shopCoins"></span></p>
    <button onclick="buyFood()">ğŸ– Acheter nourriture (10 piÃ¨ces)</button>
  </div>
</div>

<!-- JEUX MENU -->
<div id="games" class="page">
  <div class="card">
    <h1>ğŸ® Jeux</h1>
    <button onclick="showPage('demineur'); initGame();">ğŸ’£ Mini DÃ©mineur</button>
  </div>
</div>

<!-- DEMINEUR -->
<div id="demineur" class="page">
  <div class="card">
    <h1>ğŸ’£ Mini DÃ©mineur</h1>
    <div id="board"></div>
    <p id="message"></p>
    <button onclick="initGame()">Rejouer</button>
    <button onclick="showPage('games')">â¬… Retour</button>
  </div>
</div>

<script>
let pets = [];
let activePetIndex = null;
let coins = 20;
let lastUpdate = Date.now();

// ---------------- NAVIGATION
function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

// ---------------- SAVE / LOAD
function save(){
  localStorage.setItem("petGameFinal", JSON.stringify({
    pets,
    activePetIndex,
    coins,
    lastUpdate
  }));
}

function load(){
  const data = localStorage.getItem("petGameFinal");
  if(data){
    const parsed = JSON.parse(data);
    pets = parsed.pets || [];
    activePetIndex = parsed.activePetIndex;
    coins = parsed.coins || 20;
    lastUpdate = parsed.lastUpdate || Date.now();
  }

  applyOfflineProgress();

  if(pets.length>0 && activePetIndex!==null){
    update();
    showPage("pet");
  } else {
    showPage("home");
  }
}

// ---------------- OFFLINE SYSTEM (24h friendly)
function applyOfflineProgress(){
  const now = Date.now();
  const hours = (now - lastUpdate)/1000/60/60;

  pets.forEach(p=>{
    p.hunger += hours * 2;      // lent
    p.sadness += hours * 1.5;   // trÃ¨s lent
    p.happiness -= hours * 1.5;

    p.hunger = Math.min(100,p.hunger);
    p.sadness = Math.min(100,p.sadness);
    p.happiness = Math.max(0,p.happiness);
  });

  lastUpdate = now;
  save();
}

// ---------------- PET ACTIONS
function update(){
  if(activePetIndex===null) return;
  const p = pets[activePetIndex];

  document.getElementById("petName").innerText = p.name;
  document.getElementById("coinsDisplay").innerText = coins;
  document.getElementById("shopCoins").innerText = coins;

  document.getElementById("happinessBar").style.width = p.happiness+"%";
  document.getElementById("hungerBar").style.width = p.hunger+"%";
  document.getElementById("sadnessBar").style.width = p.sadness+"%";
}

function adopt(){
  const name = document.getElementById("newPetName").value;
  if(!name) return alert("Donne un nom");

  pets.push({
    name,
    happiness:80,
    hunger:20,
    sadness:20
  });

  activePetIndex = pets.length-1;
  save();
  update();
  showPage("pet");
}

function feed(){
  if(coins<5) return alert("Pas assez de piÃ¨ces !");
  const p = pets[activePetIndex];
  p.hunger -=20;
  p.happiness +=5;
  coins -=5;
  clamp(p);
  save();
  update();
}

function play(){
  const p = pets[activePetIndex];
  p.happiness +=15;
  p.sadness -=10;
  clamp(p);
  save();
  update();
}

function buyFood(){
  if(coins<10) return alert("Pas assez !");
  coins -=10;
  save();
  update();
}

function clamp(p){
  p.hunger=Math.max(0,Math.min(100,p.hunger));
  p.happiness=Math.max(0,Math.min(100,p.happiness));
  p.sadness=Math.max(0,Math.min(100,p.sadness));
}

// ---------------- DEMINEUR
const size=5;
const minesCount=5;
let board=[];
let gameOver=false;

function initGame(){
  board=[];
  gameOver=false;
  document.getElementById("message").innerText="";
  const boardDiv=document.getElementById("board");
  boardDiv.innerHTML="";

  for(let i=0;i<size;i++){
    board[i]=[];
    for(let j=0;j<size;j++){
      board[i][j]={mine:false,revealed:false};
    }
  }

  let placed=0;
  while(placed<minesCount){
    let x=Math.floor(Math.random()*size);
    let y=Math.floor(Math.random()*size);
    if(!board[x][y].mine){
      board[x][y].mine=true;
      placed++;
    }
  }

  for(let i=0;i<size;i++){
    for(let j=0;j<size;j++){
      const cell=document.createElement("div");
      cell.classList.add("cell");
      cell.onclick=()=>reveal(i,j,cell);
      boardDiv.appendChild(cell);
    }
  }
}

function reveal(i,j,cell){
  if(gameOver||board[i][j].revealed) return;
  board[i][j].revealed=true;
  cell.classList.add("revealed");

  if(board[i][j].mine){
    cell.innerText="ğŸ’£";
    document.getElementById("message").innerText="Perdu !";
    gameOver=true;
  }else{
    cell.innerText="âœ”";
    checkWin();
  }
}

function checkWin(){
  let revealed=0;
  for(let i=0;i<size;i++){
    for(let j=0;j<size;j++){
      if(board[i][j].revealed) revealed++;
    }
  }

  if(revealed===size*size-minesCount){
    document.getElementById("message").innerText="GagnÃ© ! +10 piÃ¨ces";
    gameOver=true;

    coins+=10;

    // ğŸ”¥ BONUS POUR TOUS LES ANIMAUX
    pets.forEach(p=>{
      p.happiness+=10;
      clamp(p);
    });

    save();
    update();
  }
}

load();
</script>

</body>
</html>
