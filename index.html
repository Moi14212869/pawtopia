<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Pawtopia</title>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
body {
  font-family: Arial;
  background: #a2d2ff;
  text-align: center;
  margin: 0;
  padding: 20px;
}

.page { display: none; }
.active { display: block; }

.card {
  background: white;
  max-width: 500px;
  margin: auto;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.nav button {
  margin: 5px;
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #4CAF50;
  color: white;
}

.nav button.disabled {
  cursor: not-allowed;
  opacity: 0.5;
}

.bar {
  height: 15px;
  background: #eee;
  border-radius: 10px;
  overflow: hidden;
  margin: 5px 0;
}

.fill {
  height: 100%;
  background: #4CAF50;
}

/* ===== DÃ‰MINEUR ===== */

#board {
  display: grid;
  grid-template-columns: repeat(5, 50px);
  grid-gap: 3px;
  justify-content: center;
  margin: 20px auto;
}

.cell {
  width: 50px;
  height: 50px;
  background-color: #ddd;
  font-size: 20px;
  font-weight: bold;
  line-height: 50px;
  cursor: pointer;
  user-select: none;
  border: 1px solid #aaa;
}

.cell.revealed {
  background-color: white;
  cursor: default;
}

.cell.bomb {
  background-color: #ff4d4d;
}
canvas#gameCanvas {
    background: #000;
    border-radius: 20px;
    border: 4px solid #0ff;
    box-shadow: 0 0 30px #0ff, 0 0 60px #0ff, 0 0 90px #0ff inset;
    cursor: none; /* masque le curseur */
    display: block;
    margin: auto;
}
</style>
</head>
<body>

<div class="nav">
  <button onclick="showPage('home')">ğŸ  Accueil</button>
  <button onclick="showPetPage()">ğŸ¾ Animal</button>
  <button onclick="showPage('shop')">ğŸ›’ Boutique</button>
  <button onclick="showPage('adoption')">ğŸ£ Adoption</button>
  <button onclick="showPage('games')">ğŸ® Jeux</button>
</div>

<!-- ACCUEIL -->
<div id="home" class="page active">
  <div class="card">
    <h1>ğŸŒ Pawtopia</h1>
    <p>Bienvenue dans Pawtopia !</p>
    <button onclick="showPage('adoption')">Adopter un animal</button>
  </div>
</div>

<!-- ADOPTION -->
<div id="adoption" class="page">
  <div class="card">
    <h1>ğŸ£ Adoption</h1>
    <input type="text" id="petNameInput" placeholder="Nom de ton animal"><br><br>
    <button onclick="adopt('dragon')">ğŸ‰ Dragon</button>
    <button onclick="adopt('cat')">ğŸ± Chat</button>
    <button onclick="adopt('blob')">ğŸ‘¾ Blob</button>
  </div>
</div>

<!-- ANIMAL -->
<div id="pet" class="page">
  <div class="card">
    <h1>ğŸ¾ Mon Animal</h1>
    <div style="font-size:70px;" id="petImage"></div>
    <h2 id="name"></h2>

    <p>â­ Niveau: <span id="level"></span></p>
    <p>ğŸ’° PiÃ¨ces communes: <span id="coins"></span></p>

    <p>ğŸ Faim</p>
    <div class="bar"><div id="hungerBar" class="fill"></div></div>

    <p>ğŸ˜Š Bonheur</p>
    <div class="bar"><div id="happyBar" class="fill"></div></div>

    <button onclick="feed()">Nourrir (-1ğŸ’°)</button>

    <h3>ğŸ“‹ Mes animaux</h3>
    <div id="petList"></div>
  </div>
</div>

<!-- BOUTIQUE -->
<div id="shop" class="page">
  <div class="card">
    <h1>ğŸ›’ Boutique</h1>
    <p>ğŸ’° PiÃ¨ces communes: <span id="shopCoins"></span></p>
    <button onclick="buyFood()">Acheter nourriture (10ğŸ’°)</button>
  </div>
</div>
<div id="games" class="page">
  <div class="card">
    <h1>ğŸ® Jeux</h1>
    <p>Choisis un mini-jeu :</p>

    <button onclick="showPage('demineur'); initGame();">ğŸ’£ Mini DÃ©mineur</button>
    <button onclick="showPage('avoidGame'); initAvoidGame();">ğŸƒ Ã‰vite les boules</button>
  </div>
</div>
<!-- PAGE DEMINEUR -->
<div id="demineur" class="page">
  <div class="card">
    <h1>ğŸ’£ Mini DÃ©mineur</h1>

    <div id="board"></div>
    <p id="message"></p>

    <button onclick="initGame()">Rejouer</button>
    <button onclick="showPage('games')">â¬… Retour aux jeux</button>

    <p>Clic gauche = rÃ©vÃ©ler | Clic droit = ğŸš©</p>
  </div>
</div>
  <!-- Ã‰VITE LES BOULES -->
<div id="avoidGame" class="page">
  <div class="card" style="padding:0; background:none; box-shadow:none;">
    <h1 style="color:white;">ğŸƒ Ã‰vite les boules !</h1>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <div id="score" style="position:relative; top:10px; left:10px; color:white;">Score : 0</div>
    <div id="gameOver" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); color:white; font-size:40px; display:none; text-align:center;">
      GAME OVER<br>Recharge la page
    </div>
    <button onclick="showPage('games')" style="margin-top:10px; background:#4CAF50; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">
      â¬… Retour aux jeux
    </button>
  </div>
</div>
<script>
// ================= PET GAME =================

let pets = [];
let activePetIndex = null;
let coins = 0;

const speciesData = { dragon:"ğŸ‰", cat:"ğŸ±", blob:"ğŸ‘¾" };

function showPage(id){
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function showPetPage(){
  if(activePetIndex === null){
    alert("Adopte un animal !");
    showPage("adoption");
    return;
  }
  showPage("pet");
}
function updateNavState() {
  const navButtons = document.querySelectorAll(".nav button");

  navButtons.forEach(btn => {
    // Bloque tous les boutons sauf Accueil et Adoption si aucun animal n'existe
    if (pets.length === 0 && !btn.textContent.includes("ğŸ ") && !btn.textContent.includes("ğŸ£")) {
      btn.classList.add("disabled");

      // EmpÃªche le clic et affiche un message
      btn.onclick = (e) => {
        e.preventDefault();
        alert("ğŸš« Adopte un animal avant de cliquer ici !");
      };
    } else {
      btn.classList.remove("disabled");
      btn.onclick = null; // remet le comportement normal
    }
  });
}

// Appelle cette fonction aprÃ¨s le chargement
load();
updateNavState();

// Et aprÃ¨s chaque adoption
function adopt(species){
  const name = document.getElementById("petNameInput").value || "SansNom";
  const newPet = { name, species, hunger:50, happiness:50, level:1 };

  if(pets.length === 0){
    coins = 20;
  }

  pets.push(newPet);
  activePetIndex = pets.length-1;

  save(); 
  update(); 
  updateNavState(); // â† met Ã  jour les boutons bloquÃ©s
  showPage("pet");
}

function save(){
  localStorage.setItem("petGameFinal", JSON.stringify({
    pets, activePetIndex, coins
  }));
}

function load(){
  const data = localStorage.getItem("petGameFinal");
  if(data){
    const parsed = JSON.parse(data);
    pets = parsed.pets || [];
    activePetIndex = parsed.activePetIndex;
    coins = parsed.coins || 0;
  }
  if(pets.length > 0 && activePetIndex !== null){
    update();
    showPage("pet");
  } else {
    showPage("home");
  }
}

function update(){
  if(activePetIndex === null) return;

  const pet = pets[activePetIndex];

  document.getElementById("name").textContent = pet.name;
  document.getElementById("petImage").textContent = speciesData[pet.species];
  document.getElementById("level").textContent = pet.level;
  document.getElementById("coins").textContent = coins;
  document.getElementById("shopCoins").textContent = coins;

  document.getElementById("hungerBar").style.width = pet.hunger + "%";
  document.getElementById("happyBar").style.width = pet.happiness + "%";

  const list = document.getElementById("petList");
  list.innerHTML = "";

  pets.forEach((p,index)=>{
    const btn = document.createElement("button");
    btn.textContent = speciesData[p.species] + " " + p.name;
    btn.onclick = ()=>{
      activePetIndex = index;
      save(); update();
    };
    list.appendChild(btn);
  });
}

function feed(){
  if(coins <= 0) return alert("Pas assez de piÃ¨ces !");
  const pet = pets[activePetIndex];
  pet.hunger = Math.max(0, pet.hunger - 15);
  coins -= 1;
  save(); update();
}

function buyFood(){
  if(coins >= 10){
    coins -= 10;
    alert("ğŸ Nourriture achetÃ©e !");
    save(); update();
  } else {
    alert("Pas assez de piÃ¨ces !");
  }
}

// DÃ©gradation lente (1% toutes les 30 min)
setInterval(()=>{
  if(activePetIndex === null) return;
  pets.forEach(p=>{
    p.hunger = Math.min(100, p.hunger + 1);
    p.happiness = Math.max(0, p.happiness - 1);
  });
  save(); update();
}, 1800000);
  
load();


// ================= DEMINEUR =================

const boardSize=5;
const bombCount=5;

let flags=[], board=[], revealed=[], gameOver=false;

function initGame(){
  board=Array(boardSize*boardSize).fill(0);
  flags=Array(boardSize*boardSize).fill(false);
  revealed=Array(boardSize*boardSize).fill(false);
  gameOver=false;
  document.getElementById("message").textContent="";

  let bombsPlaced=0;
  while(bombsPlaced<bombCount){
    const index=Math.floor(Math.random()*board.length);
    if(board[index]!=="B"){
      board[index]="B";
      bombsPlaced++;
      getNeighbors(index).forEach(i=>{
        if(board[i]!=="B") board[i]++;
      });
    }
  }
  renderBoard();
}

function renderBoard(){
  const boardDiv=document.getElementById("board");
  boardDiv.innerHTML="";

  board.forEach((val,index)=>{
    const cell=document.createElement("div");
    cell.classList.add("cell");

    if(revealed[index]){
      cell.classList.add("revealed");
      if(val==="B"){
        cell.classList.add("bomb");
        cell.textContent="ğŸ’£";
      } else if(val>0){
        cell.textContent=val;
      }
    } else if(flags[index]){
      cell.textContent="ğŸš©";
    }

    cell.addEventListener("click",()=>revealCell(index));
    cell.addEventListener("contextmenu",(e)=>{
      e.preventDefault();
      toggleFlag(index);
    });

    boardDiv.appendChild(cell);
  });
}

function getNeighbors(index){
  const neighbors=[];
  const row=Math.floor(index/boardSize);
  const col=index%boardSize;

  for(let dr=-1;dr<=1;dr++){
    for(let dc=-1;dc<=1;dc++){
      if(dr===0 && dc===0) continue;
      const r=row+dr;
      const c=col+dc;
      if(r>=0 && r<boardSize && c>=0 && c<boardSize){
        neighbors.push(r*boardSize+c);
      }
    }
  }
  return neighbors;
}

function toggleFlag(index){
  if(revealed[index] || gameOver) return;
  flags[index]=!flags[index];
  renderBoard();
}

function revealCell(index){
  if(gameOver || revealed[index]) return;

  revealed[index]=true;

  if(board[index]==="B"){
    gameOver=true;
    document.getElementById("message").textContent="ğŸ’¥ BOOM ! Perdu.";
    revealAll();
    return;
  }

  if(board[index]===0){
    getNeighbors(index).forEach(revealCell);
  }

  if(revealed.filter((v,i)=>!v && board[i]!=="B").length===0){
    gameOver=true;
    document.getElementById("message").textContent="ğŸ‰ GagnÃ© ! +10ğŸ’° +15ğŸ˜Š pour tous !";
    revealAll();
    rewardAllPets();
  }

  renderBoard();
}

function revealAll(){
  for(let i=0;i<board.length;i++){
    revealed[i]=true;
  }
  renderBoard();
}

function rewardAllPets(){
  coins += 10;
  pets.forEach(p=>{
    p.happiness = Math.min(100, p.happiness + 15);
  });
  save(); update();
}
function initAvoidGame(){
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const gameOverText = document.getElementById("gameOver");

  let mouseX = canvas.width / 2;
  let mouseY = canvas.height / 2;

  let enemies = [];
  let bonuses = [];
  let score = 0;
  let gameRunning = true;
  let shieldActive = false;

  canvas.addEventListener("mousemove", (e) => {
      const rect = canvas.getBoundingClientRect();
      mouseX = e.clientX - rect.left;
      mouseY = e.clientY - rect.top;
  });

  function spawnEnemy() {
      if (!gameRunning) return;

      enemies.push({
          x: -30,
          y: Math.random() * canvas.height,
          radius: 15,
          speed: 3 + Math.random() * 3,
          color: `hsl(${Math.random()*360}, 80%, 50%)` // couleurs vives alÃ©atoires
      });

      if (Math.random() < 0.1) {
          bonuses.push({
              x: -30,
              y: Math.random() * canvas.height,
              radius: 12,
              speed: 2 + Math.random() * 2
          });
      }
  }

  function checkCollisionCircle(aX, aY, aR, bX, bY, bR) {
      const dx = aX - bX;
      const dy = aY - bY;
      return Math.sqrt(dx*dx + dy*dy) < aR + bR;
  }

  function handleGameOver() {
      gameRunning = false;
      gameOverText.style.display = "block";

      // RÃ©compenser les pets
      pets.forEach(p => {
          p.happiness = Math.min(100, p.happiness + 15);
      });
      coins += score;
      save(); update();

      setTimeout(() => {
          gameOverText.style.display = "none";
          showPage("games");
      }, 5000);
  }

  function update() {
      if (!gameRunning) return;

      // Fond noir
      ctx.fillStyle = "#000";
      ctx.fillRect(0,0,canvas.width,canvas.height);

      // Afficher score
      ctx.fillStyle = "white";
      ctx.font = "24px Arial";
      ctx.fillText("Score : " + score, 20, 30);

  // Joueur
  ctx.save();
  ctx.beginPath();
  ctx.arc(mouseX, mouseY, 10, 0, Math.PI*2);
  ctx.fillStyle = shieldActive ? "lime" : "cyan";
  ctx.shadowBlur = 20;
  ctx.shadowColor = shieldActive ? "lime" : "cyan";
  ctx.fill();
  ctx.closePath();
  ctx.restore();

  // Ennemis
  for(let i=enemies.length-1;i>=0;i--){
      const e = enemies[i];
      e.x += e.speed;

      if(checkCollisionCircle(mouseX, mouseY,10,e.x,e.y,e.radius)){
          if(shieldActive){ shieldActive=false; enemies.splice(i,1);}
          else{ handleGameOver(); return; }
      }

      ctx.save();
      ctx.beginPath();
      ctx.arc(e.x,e.y,e.radius,0,Math.PI*2);
      ctx.fillStyle = e.color;
      ctx.shadowBlur = 15;
      ctx.shadowColor = e.color;
      ctx.fill();
      ctx.closePath();
      ctx.restore();

      if(e.x - e.radius > canvas.width){ enemies.splice(i,1); score++; }
  }

  // Bonus
  for(let i=bonuses.length-1;i>=0;i--){
      const b = bonuses[i];
      b.x += b.speed;

      if(checkCollisionCircle(mouseX, mouseY,10,b.x,b.y,b.radius)){
          shieldActive = true;
          bonuses.splice(i,1);
      }

      ctx.save();
      ctx.beginPath();
      ctx.arc(b.x,b.y,b.radius,0,Math.PI*2);
      ctx.fillStyle = "lime";
      ctx.shadowBlur = 15;
      ctx.shadowColor = "lime";
      ctx.fill();
      ctx.closePath();
      ctx.restore();

      if(b.x - b.radius > canvas.width) bonuses.splice(i,1);
  }

      requestAnimationFrame(update);
  }

  setInterval(spawnEnemy, 800);
  update();
}
initGame();
</script>

</body>
</html>
