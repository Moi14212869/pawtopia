<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mini Pet World</title>

<style>
body {
  font-family: Arial;
  background: linear-gradient(to bottom, #a2d2ff, white);
  text-align: center;
  margin: 0;
  padding: 20px;
}

.page { display: none; }
.active { display: block; }

.card {
  background: white;
  max-width: 500px;
  margin: auto;
  padding: 20px;
  border-radius: 15px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}

.nav button {
  margin: 5px;
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background: #4CAF50;
  color: white;
}

.nav button:disabled {
  opacity: 0.5;
}

.bar {
  height: 15px;
  background: #eee;
  border-radius: 10px;
  overflow: hidden;
  margin: 5px 0;
}

.fill {
  height: 100%;
  background: #4CAF50;
}

/* ===== DÃ‰MINEUR ===== */

#board {
  display: grid;
  grid-template-columns: repeat(5, 50px);
  grid-gap: 3px;
  justify-content: center;
  margin: 20px auto;
}

.cell {
  width: 50px;
  height: 50px;
  background-color: #ddd;
  font-size: 20px;
  font-weight: bold;
  line-height: 50px;
  cursor: pointer;
  user-select: none;
  border: 1px solid #aaa;
}

.cell.revealed {
  background-color: white;
  cursor: default;
}

.cell.bomb {
  background-color: #ff4d4d;
}
</style>
</head>
<body>

<div class="nav">
  <button onclick="showPage('home')">ğŸ  Accueil</button>
  <button onclick="showPetPage()">ğŸ¾ Animal</button>
  <button onclick="showPage('shop')">ğŸ›’ Boutique</button>
  <button onclick="showPage('adoption')">ğŸ£ Adoption</button>
  <button onclick="showPage('games')">ğŸ® Jeux</button>
</div>

<!-- ACCUEIL -->
<div id="home" class="page active">
  <div class="card">
    <h1>ğŸŒ Mini Pet World</h1>
    <p>Bienvenue dans ton monde virtuel !</p>
  </div>
</div>

<!-- ADOPTION -->
<div id="adoption" class="page">
  <div class="card">
    <h1>ğŸ£ Adoption</h1>
    <input type="text" id="petNameInput" placeholder="Nom de ton animal"><br><br>
    <button onclick="adopt('dragon')">ğŸ‰ Dragon</button>
    <button onclick="adopt('cat')">ğŸ± Chat</button>
    <button onclick="adopt('blob')">ğŸ‘¾ Blob</button>
  </div>
</div>

<!-- ANIMAL -->
<div id="pet" class="page">
  <div class="card">
    <h1>ğŸ¾ Mon Animal</h1>
    <div style="font-size:70px;" id="petImage"></div>
    <h2 id="name"></h2>

    <p>â­ Niveau: <span id="level"></span></p>
    <p>ğŸ’° PiÃ¨ces communes: <span id="coins"></span></p>

    <p>ğŸ Faim</p>
    <div class="bar"><div id="hungerBar" class="fill"></div></div>

    <p>ğŸ˜Š Bonheur</p>
    <div class="bar"><div id="happyBar" class="fill"></div></div>

    <button onclick="feed()">Nourrir (-1ğŸ’°)</button>

    <h3>ğŸ“‹ Mes animaux</h3>
    <div id="petList"></div>
  </div>
</div>

<!-- BOUTIQUE -->
<div id="shop" class="page">
  <div class="card">
    <h1>ğŸ›’ Boutique</h1>
    <p>ğŸ’° PiÃ¨ces communes: <span id="shopCoins"></span></p>
    <button onclick="buyFood()">Acheter nourriture (10ğŸ’°)</button>
  </div>
</div>
<div id="games" class="page">
  <div class="card">
    <h1>ğŸ® Jeux</h1>
    <p>Choisis un mini-jeu :</p>

    <button onclick="showPage('demineur'); initGame();">
      ğŸ’£ Mini DÃ©mineur
    </button>
  </div>
</div>
<!-- PAGE DEMINEUR -->
<div id="demineur" class="page">
  <div class="card">
    <h1>ğŸ’£ Mini DÃ©mineur</h1>

    <div id="board"></div>
    <p id="message"></p>

    <button onclick="initGame()">Rejouer</button>
    <button onclick="showPage('games')">â¬… Retour aux jeux</button>

    <p>Clic gauche = rÃ©vÃ©ler | Clic droit = ğŸš©</p>
  </div>
</div>
<script>
// ================= PET GAME =================

let pets = [];
let activePetIndex = null;
let coins = 0;

const speciesData = { dragon:"ğŸ‰", cat:"ğŸ±", blob:"ğŸ‘¾" };

function showPage(id){
  document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function showPetPage(){
  if(activePetIndex === null){
    alert("Adopte un animal !");
    showPage("adoption");
    return;
  }
  showPage("pet");
}

function adopt(species){
  const name = document.getElementById("petNameInput").value || "SansNom";
  const newPet = { name, species, hunger:50, happiness:50, level:1 };

  if(pets.length === 0){
    coins = 20;
  }

  pets.push(newPet);
  activePetIndex = pets.length-1;

  save(); update(); showPage("pet");
}

function save(){
  localStorage.setItem("petGameFinal", JSON.stringify({
    pets, activePetIndex, coins
  }));
}

function load(){
  const data = localStorage.getItem("petGameFinal");
  if(data){
    const parsed = JSON.parse(data);
    pets = parsed.pets || [];
    activePetIndex = parsed.activePetIndex;
    coins = parsed.coins || 0;
  }
  if(pets.length > 0 && activePetIndex !== null){
    update();
    showPage("pet");
  } else {
    showPage("adoption");
  }
}

function update(){
  if(activePetIndex === null) return;

  const pet = pets[activePetIndex];

  document.getElementById("name").textContent = pet.name;
  document.getElementById("petImage").textContent = speciesData[pet.species];
  document.getElementById("level").textContent = pet.level;
  document.getElementById("coins").textContent = coins;
  document.getElementById("shopCoins").textContent = coins;

  document.getElementById("hungerBar").style.width = pet.hunger + "%";
  document.getElementById("happyBar").style.width = pet.happiness + "%";

  const list = document.getElementById("petList");
  list.innerHTML = "";

  pets.forEach((p,index)=>{
    const btn = document.createElement("button");
    btn.textContent = speciesData[p.species] + " " + p.name;
    btn.onclick = ()=>{
      activePetIndex = index;
      save(); update();
    };
    list.appendChild(btn);
  });
}

function feed(){
  if(coins <= 0) return alert("Pas assez de piÃ¨ces !");
  const pet = pets[activePetIndex];
  pet.hunger = Math.max(0, pet.hunger - 15);
  coins -= 1;
  save(); update();
}

function buyFood(){
  if(coins >= 10){
    coins -= 10;
    alert("ğŸ Nourriture achetÃ©e !");
    save(); update();
  } else {
    alert("Pas assez de piÃ¨ces !");
  }
}

// DÃ©gradation lente (1% toutes les 30 min)
setInterval(()=>{
  if(activePetIndex === null) return;
  pets.forEach(p=>{
    p.hunger = Math.min(100, p.hunger + 1);
    p.happiness = Math.max(0, p.happiness - 1);
  });
  save(); update();
}, 1800000);

load();


// ================= DEMINEUR =================

const boardSize=5;
const bombCount=5;

let flags=[], board=[], revealed=[], gameOver=false;

function initGame(){
  board=Array(boardSize*boardSize).fill(0);
  flags=Array(boardSize*boardSize).fill(false);
  revealed=Array(boardSize*boardSize).fill(false);
  gameOver=false;
  document.getElementById("message").textContent="";

  let bombsPlaced=0;
  while(bombsPlaced<bombCount){
    const index=Math.floor(Math.random()*board.length);
    if(board[index]!=="B"){
      board[index]="B";
      bombsPlaced++;
      getNeighbors(index).forEach(i=>{
        if(board[i]!=="B") board[i]++;
      });
    }
  }
  renderBoard();
}

function renderBoard(){
  const boardDiv=document.getElementById("board");
  boardDiv.innerHTML="";

  board.forEach((val,index)=>{
    const cell=document.createElement("div");
    cell.classList.add("cell");

    if(revealed[index]){
      cell.classList.add("revealed");
      if(val==="B"){
        cell.classList.add("bomb");
        cell.textContent="ğŸ’£";
      } else if(val>0){
        cell.textContent=val;
      }
    } else if(flags[index]){
      cell.textContent="ğŸš©";
    }

    cell.addEventListener("click",()=>revealCell(index));
    cell.addEventListener("contextmenu",(e)=>{
      e.preventDefault();
      toggleFlag(index);
    });

    boardDiv.appendChild(cell);
  });
}

function getNeighbors(index){
  const neighbors=[];
  const row=Math.floor(index/boardSize);
  const col=index%boardSize;

  for(let dr=-1;dr<=1;dr++){
    for(let dc=-1;dc<=1;dc++){
      if(dr===0 && dc===0) continue;
      const r=row+dr;
      const c=col+dc;
      if(r>=0 && r<boardSize && c>=0 && c<boardSize){
        neighbors.push(r*boardSize+c);
      }
    }
  }
  return neighbors;
}

function toggleFlag(index){
  if(revealed[index] || gameOver) return;
  flags[index]=!flags[index];
  renderBoard();
}

function revealCell(index){
  if(gameOver || revealed[index]) return;

  revealed[index]=true;

  if(board[index]==="B"){
    gameOver=true;
    document.getElementById("message").textContent="ğŸ’¥ BOOM ! Perdu.";
    revealAll();
    return;
  }

  if(board[index]===0){
    getNeighbors(index).forEach(revealCell);
  }

  if(revealed.filter((v,i)=>!v && board[i]!=="B").length===0){
    gameOver=true;
    document.getElementById("message").textContent="ğŸ‰ GagnÃ© ! +10ğŸ’° +15ğŸ˜Š pour tous !";
    revealAll();
    rewardAllPets();
  }

  renderBoard();
}

function revealAll(){
  for(let i=0;i<board.length;i++){
    revealed[i]=true;
  }
  renderBoard();
}

function rewardAllPets(){
  coins += 10;
  pets.forEach(p=>{
    p.happiness = Math.min(100, p.happiness + 15);
  });
  save(); update();
}

initGame();
</script>

</body>
</html>
